use crate::models::{
    account::{Account, LinkdingAccountApiResponse},
    bookmarks::{Bookmark, BookmarkRemoveResponse, DetailedResponse},
    provider::Provider,
};
use crate::{
    app::{
        config::{AppTheme, CosmicConfig, SortOption},
        context::ContextPage,
        dialog::DialogPage,
    },
    models::bookmarks::BookmarkCheckDetailsResponse,
};
use cosmic::{
    iced::keyboard::{Key, Modifiers},
    iced_core::image::Bytes,
    widget::{self},
};

use std::{path::PathBuf, time::Instant};

#[derive(Debug, Clone)]
pub enum ApplicationAction {
    AccountsView(AccountsAction),
    AddAccountForm,
    AddBookmarkForm,
    AddBookmarkFormAccountIndex(usize),
    AppTheme(AppTheme),
    BookmarksView(BookmarksAction),
    CloseToast(widget::ToastId),
    CompleteRemoveDialog(Option<i64>, Option<Bookmark>),
    ContextClose,
    DecrementPageIndex(String),
    DialogCancel,
    DialogUpdate(DialogPage),
    DoneAddAccount(Account, Option<LinkdingAccountApiResponse>),
    DoneAddBookmark(
        Account,
        Option<BookmarkCheckDetailsResponse>,
        Option<ImportAction>,
        Vec<(Bookmark, ImportAction)>,
    ),
    DoneEditAccount(Account, Option<LinkdingAccountApiResponse>),
    DoneEditBookmark(Account, Option<BookmarkCheckDetailsResponse>),
    DoneFetchFaviconForBookmark(String, Bytes),
    DoneRefreshAccountProfile(Account, Option<LinkdingAccountApiResponse>),
    DoneRefreshSingleAccount(DetailedResponse, Vec<Account>),
    DoneRemoveBookmark(Account, Bookmark, Option<BookmarkRemoveResponse>),
    EditAccountForm(Account),
    EditBookmarkForm(i64, Bookmark),
    Empty,
    EnableFavicons(bool),
    ExportBookmarksSelectAccounts(Vec<bool>),
    ImportBookmarksSelectAccount(usize),
    StartExportBookmarks,
    StartImportBookmarks,
    SelectExportPath,
    SelectImportPath,
    SetExportPath(Option<PathBuf>),
    SetImportPath(Option<PathBuf>),
    PerformExportBookmarks(Vec<Account>),
    PerformImportBookmarks(Account),
    CancelImportBookmarks(u64),
    DoneImportBookmarks(usize),
    IncrementPageIndex(String),
    InputBookmarkDescription(widget::text_editor::Action),
    InputBookmarkNotes(widget::text_editor::Action),
    Key(Modifiers, Key),
    LoadAccounts,
    LoadBookmarks,
    Modifiers(Modifiers),
    OpenAccountsPage,
    OpenExternalUrl(String),
    OpenPurgeFaviconsCache,
    OpenRemoveAccountDialog(Account),
    OpenRemoveBookmarkDialog(i64, Bookmark),
    PurgeFaviconsCache,
    RemoveAccount(Account),
    SearchActivate,
    SearchBookmarks(String),
    SetAccountAPIKey(String),
    SetAccountDisplayName(String),
    SetAccountInstance(String),
    SetAccountProvider(Provider),
    SetAccountStatus(bool),
    SetAccountTrustInvalidCertificates(bool),
    SetBookmarkArchived(bool),
    SetBookmarkShared(bool),
    SetBookmarkTags(String),
    SetBookmarkTitle(String),
    SetBookmarkURL(String),
    SetBookmarkUnread(bool),
    SetItemsPerPage(u8),
    SortOption(SortOption),
    StartAddAccount(Account),
    StartAddBookmark(
        Account,
        Bookmark,
        Option<ImportAction>,
        Vec<(Bookmark, ImportAction)>,
    ),
    StartEditAccount(Account),
    StartEditBookmark(Account, Bookmark),
    StartFetchFaviconForBookmark(Bookmark),
    StartRefreshAccountProfile(Account),
    StartRefreshBookmarksForAccount(Account),
    StartRefreshBookmarksForAllAccounts,
    StartRemoveBookmark(i64, Bookmark),
    StartupCompleted,
    SystemThemeModeChange,
    Tick(Instant),
    ToggleContextPage(ContextPage),
    UpdateConfig(CosmicConfig),
    ViewBookmarkNotes(Bookmark),
}

#[derive(Debug, Clone)]
pub enum AccountsAction {
    AddAccount,
    CancelImport(u64),
    DecrementPageIndex,
    DeleteAccount(Account),
    EditAccount(Account),
    IncrementPageIndex,
    OpenExternalURL(String),
    RefreshBookmarksForAccount(Account),
    ToggleAccountStatus(Account),
}

#[derive(Debug, Clone)]
pub enum BookmarksAction {
    AddBookmark,
    CancelImport(u64),
    ClearSearch,
    DecrementPageIndex,
    DeleteBookmark(i64, Bookmark),
    EditBookmark(i64, Bookmark),
    EmptyMessage,
    IncrementPageIndex,
    OpenAccountsPage,
    OpenExternalURL(String),
    RefreshBookmarks,
    SearchBookmarks(String),
    ViewNotes(Bookmark),
}

#[derive(Debug, Clone, PartialEq, Eq, Hash)]
pub struct ImportAction {
    pub import_id: u64,
    pub total_count: usize,
    pub current_index: usize,
}
